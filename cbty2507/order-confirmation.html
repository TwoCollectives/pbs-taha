<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Google Analytics (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TCMBEP4S50"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-TCMBEP4S50');
</script>

<!-- PURCHASE TRACKING (GA4 E-commerce Compliant) -->
<script>
    window.addEventListener("DOMContentLoaded", function () {

        const params = new URLSearchParams(window.location.search);
        const vtid = params.get("vtid") || "unknown";
        const amount = parseFloat(params.get("amount") || "0");
        // Handle all ClickBank formats: item=1|2|3 OR item=1 OR item=1&item=2&item=3
        let items = [];

        if (params.getAll("item").length > 1) {
          // Case: ?item=1&item=4&item=7
          items = params.getAll("item");
        } else if (params.get("item")) {
          // Case: ?item=1|4|7 or ?item=6
          items = params.get("item").split("|");
        } else if (params.get("cbitems")) {
          // fallback: if ClickBank only sends cbitems
          items = [ params.get("cbitems") ];
        }

        const orderID = (params.get("cbreceipt") || "unknown").split("|")[0];

        const productMap = {
          "1": { name: "Pegasus", price: 47 },
          "2": { name: "The Code", price: 97 },
          "3": { name: "The Code ($30 OFF)", price: 67 },
          "4": { name: "The Vault", price: 67 },
          "5": { name: "The Vault ($40 OFF)", price: 27 },
          "6": { name: "Pegasus X-Files", price: 29 },
          "7": { name: "Pegasus X-Files ($10 OFF)", price: 19 }
        };

        // Build GA4 items array
        const ga4Items = items.map(pid => {
          const p = productMap[pid];
          return {
            item_id: pid,
            item_name: p.name,
            price: p.price,
            quantity: 1
          };
        });

        // Send upsell events (optional but useful)
        items.forEach(pid => {
          const p = productMap[pid];
          gtag("event", "upsell_purchase", {
            item_id: pid,
            item_name: p.name,
            price: p.price,
            value: p.price,
            currency: "USD",
            vtid: vtid
          });
        });

        // Send main purchase event
        gtag("event", "purchase", {
          transaction_id: orderID,
          value: amount,
          currency: "USD",
          vtid: vtid,
          items: ga4Items
        });

    });
</script>

<title>Thank You For Your Purchase</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f4f7;
    margin: 0;
    padding: 40px 0;
  }

  .card {
    max-width: 820px;
    margin: auto;
    background: white;
    border: 1px solid #e6e6e6;
    padding: 40px 40px 60px;
    border-radius: 18px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.06);
  }

  .center { text-align: center; }

  .checkmark {
    width: 55px;
    display: block;
    margin: 0 auto 10px;
  }

  h2 {
    font-size: 24px;
    margin: 10px 0 5px;
    color: #111;
  }

  .order-pill {
    background: #eef1f5;
    color: #555;
    display: inline-block;
    border-radius: 12px;
    padding: 6px 14px;
    font-size: 13px;
    margin-top: 8px;
    font-weight: bold;
  }

  .section-title {
    font-weight: bold;
    margin-top: 35px;
    margin-bottom: 12px;
    color: #333;
    font-size: 18px;
  }

  .flex { display: flex; }
  .space-between { justify-content: space-between; }

  .info-box {
    width: 48%;
    font-size: 14px;
    color: #444;
    line-height: 1.5;
  }

  .summary-box {
    background: #fafbfc;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 20px;
    margin-top: 10px;
  }

  .order-item {
    display: flex;
    align-items: center;
    padding: 18px 0;
    border-bottom: 1px solid #e5e7eb;
  }

  .order-item img {
    width: 60px;
    margin-right: 16px;
  }

  .order-name {
    flex-grow: 1;
    font-size: 15px;
    color: #333;
  }

  .order-price {
    font-weight: bold;
    font-size: 15px;
  }

  .access-btn {
    display: inline-block;
    margin-top: 8px;
    padding: 9px 16px;
    background: linear-gradient(90deg, #b08d57, #8d6a3d);
    color: #fff;
    border-radius: 8px;
    font-weight: bold;
    text-decoration: none;
    font-size: 14px;
    box-shadow: 0 0 14px rgba(176,141,87,0.45);
    transition: 0.25s ease;
    animation: pulseGold 1.8s infinite ease-in-out;
  }

  .access-btn:hover {
    background: linear-gradient(90deg, #d6b77a, #b08d57);
    box-shadow: 0 0 22px rgba(214,183,122,0.75);
    transform: translateY(-2px);
  }

  @keyframes pulseGold {
    0% { box-shadow: 0 0 10px rgba(214,183,122,0.35); }
    50% { box-shadow: 0 0 20px rgba(214,183,122,0.85); }
    100% { box-shadow: 0 0 10px rgba(214,183,122,0.35); }
  }

  .total-box {
    font-size: 20px;
    font-weight: bold;
    text-align: right;
    margin-top: 20px;
    color: #111;
  }

  /* ✅ FIXED: modal overlay scroll */
  #videoModal {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.65);
    backdrop-filter: blur(6px);
    z-index:99999;

    /* OLD: align-items:center; caused scroll trap */
    display: none;
    align-items: flex-start;     /* ✅ allow top alignment */
    justify-content: center;

    padding: 20px;
    overflow-y: auto;            /* ✅ allow scrolling */
    -webkit-overflow-scrolling: touch; /* ✅ smooth iOS scroll */
  }

  /* ✅ give the inner box spacing so it scrolls nicely */
  #videoModalInner {
    width:100%;
    max-width:900px;
    background:#000;
    border-radius:16px;
    position:relative;
    overflow:hidden;
    margin: 20px 0;              /* ✅ prevents sticking to top/bottom */
    box-shadow:0 0 35px rgba(214,183,122,0.9), 0 0 70px rgba(176,141,87,0.55), 0 20px 60px rgba(0,0,0,0.55);
  }

  .close-btn {
    position:absolute;
    top:12px;
    right:12px;
    font-size:26px;
    cursor:pointer;
    color:#fff;
    padding:6px 12px;
    background:rgba(0,0,0,0.55);
    border-radius:8px;
    z-index: 2;
  }

  /* ✅ Button under video INSIDE popup */
  .video-modal-btn-wrap {
    text-align: center;
    padding: 22px;
    background: #fff;
  }

  .video-modal-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;

    width: 100%;
    max-width: 100%;
    box-sizing: border-box;

    padding: 18px 28px;
    border-radius: 16px;

    font-weight: 800;
    letter-spacing: 0.3px;
    font-size: 18px;
    text-decoration: none;
    color: #fff;

    border: 1px solid rgba(255, 255, 255, 0.18);
    background:
      radial-gradient(120% 120% at 20% 0%, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0) 55%),
      linear-gradient(90deg, #c9a46a, #8d6a3d);

    box-shadow:
      0 12px 28px rgba(0,0,0,0.45),
      0 0 0 1px rgba(214,183,122,0.18),
      0 0 26px rgba(214,183,122,0.55);

    position: relative;
    overflow: hidden;

    transition: transform 180ms ease, box-shadow 180ms ease, filter 180ms ease;
    animation: ctaGlow 2.4s infinite ease-in-out;
  }

  .video-modal-btn::before {
    content: "";
    position: absolute;
    inset: -40%;
    background: linear-gradient(
      120deg,
      rgba(255,255,255,0) 35%,
      rgba(255,255,255,0.28) 50%,
      rgba(255,255,255,0) 65%
    );
    transform: translateX(-60%) rotate(12deg);
    transition: transform 600ms ease;
    pointer-events: none;
  }

  .video-modal-btn:hover {
    transform: translateY(-2px);
    filter: brightness(1.04);
    box-shadow:
      0 16px 40px rgba(0,0,0,0.55),
      0 0 0 1px rgba(214,183,122,0.22),
      0 0 34px rgba(214,183,122,0.70);
  }

  .video-modal-btn:hover::before {
    transform: translateX(60%) rotate(12deg);
  }

  .video-modal-btn:active {
    transform: translateY(0px) scale(0.99);
  }

  @keyframes ctaGlow {
    0%   { box-shadow: 0 12px 28px rgba(0,0,0,0.45), 0 0 0 1px rgba(214,183,122,0.18), 0 0 22px rgba(214,183,122,0.45); }
    50%  { box-shadow: 0 14px 34px rgba(0,0,0,0.52), 0 0 0 1px rgba(214,183,122,0.22), 0 0 34px rgba(214,183,122,0.78); }
    100% { box-shadow: 0 12px 28px rgba(0,0,0,0.45), 0 0 0 1px rgba(214,183,122,0.18), 0 0 22px rgba(214,183,122,0.45); }
  }

  .video-modal-copy {
    margin: 16px 0 14px;
    color: #1a1a1a;
    font-size: 15px;
    line-height: 1.55;
    text-align: center;
  }
  .video-modal-copy strong { font-weight: 800; }

  .video-modal-btn-secondary {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;

    width: 100%;
    max-width: 100%;
    box-sizing: border-box;

    padding: 16px 28px;
    border-radius: 16px;

    font-weight: 800;
    letter-spacing: 0.3px;
    font-size: 17px;
    text-decoration: none;

    color: #111;
    background: #fff;
    border: 2px solid rgba(141,106,61,0.35);

    box-shadow: 0 10px 22px rgba(0,0,0,0.10);
    transition: transform 180ms ease, box-shadow 180ms ease, filter 180ms ease;
  }

  .video-modal-btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 14px 28px rgba(0,0,0,0.14);
    filter: brightness(1.02);
  }

  #supportModal {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.65);
    backdrop-filter: blur(6px);
    z-index:99998;
    align-items:center;
    justify-content:center;
    padding:20px;
  }

  #supportModalInner {
    max-width:500px;
    width:100%;
    background:#fff;
    border-radius:18px;
    padding:35px 30px;
    position:relative;
    box-shadow:0 0 35px rgba(214,183,122,0.8), 0 0 70px rgba(176,141,87,0.5), 0 20px 60px rgba(0,0,0,0.4);
  }

  .support-title {
    text-align:center;
    font-size:22px;
    margin-bottom:25px;
    color:#222;
    font-weight:bold;
  }

  .support-options {
    display:flex;
    flex-direction:column;
    gap:18px;
  }

  .support-btn {
    display:block;
    width:100%;
    max-width:260px;
    padding:14px 16px;
    background:linear-gradient(90deg, #b08d57, #8d6a3d);
    color:#fff !important;
    text-decoration:none;
    border-radius:10px;
    font-size:14px;
    text-align:center;
    font-weight:bold;
    margin:0 auto;
  }

  .support-btn:hover {
    background:linear-gradient(90deg,#d6b77a,#b08d57);
  }

  .support-close {
    position:absolute;
    top:12px;
    right:12px;
    font-size:22px;
    cursor:pointer;
    color:#111;
    padding:6px 10px;
    background:#f1f1f1;
    border-radius:10px;
  }
</style>
</head>

<body>

<div class="card">

  <img src="/images/checkmark.png" class="checkmark" alt="Success">

  <div class="center">
    <h2>Hello — thank you for your purchase!</h2>
    <div class="order-pill">
      ORDER NO: <span id="order-id">Loading...</span>
    </div>
  </div>

  <!-- Click to open video popup -->
  <div style="margin-top: 30px; cursor:pointer;" onclick="openVideoModal()">
    <img src="/images/watchthis.png" style="width: 100%; border-radius: 12px;" alt="Watch Video">
  </div>

  <div class="flex space-between" style="margin-top: 35px;">
    <div class="info-box">
      <div class="section-title">Customer</div>
      <div id="customer-name"></div>
      <div id="customer-email"></div>
    </div>

    <div class="info-box">
      <div class="section-title">Shipping</div>
      <div id="shipping-address"></div>
    </div>
  </div>

  <div class="section-title" style="margin-top: 40px;">Order Summary</div>

  <div class="summary-box">
    <div id="order-summary"></div>

    <div class="total-box" id="order-total">Total: $0.00</div>

    <div style="text-align:center; margin-top: 25px;">
      <a onclick="openSupportModal()"
         style="
           display:block;
           width:100%;
           max-width:220px;
           margin:0 auto;
           padding:14px 20px;
           background: linear-gradient(90deg, #b08d57, #8d6a3d);
           color:#fff;
           border-radius: 10px;
           font-weight:bold;
           font-size:15px;
           cursor:pointer;">
         Contact Support
      </a>
    </div>

  </div>

</div>

<!-- VIDEO MODAL -->
<div id="videoModal">
  <div id="videoModalInner">
    <span class="close-btn" onclick="closeVideoModal()">✖</span>

    <iframe 
      id="welcomeVideo"
      src=""
      width="100%"
      height="500"
      frameborder="0"
      allow="autoplay; fullscreen; picture-in-picture"
      allowfullscreen></iframe>

    <div class="video-modal-btn-wrap">
      <a class="video-modal-btn"
         href="https://jvz3.com/c/3218449/415009?tid=typage"
         target="_blank"
         rel="noopener">
        ▶ Watch Free Training
      </a>

      <div class="video-modal-copy">
        Before you start your journey, I highly recommend joining this exclusive free training.<br><br>
        Inside, you’ll discover how to potentially <strong>double—or even triple—your passive income.</strong><br><br>
        <strong>Spots are limited.</strong>
      </div>

      <a class="video-modal-btn-secondary"
         href="https://jvz3.com/c/3218449/415009?tid=typage"
         target="_blank"
         rel="noopener">
        Claim Your Free Spot Now
      </a>
    </div>

  </div>
</div>

<!-- SUPPORT MODAL -->
<div id="supportModal">
  <div id="supportModalInner">

    <span class="support-close" onclick="closeSupportModal()">✖</span>

    <h2 class="support-title">How can we help?</h2>

    <div class="support-options">
      <a class="support-btn" id="orderQuestion">I have a question about my order</a>
      <a class="support-btn" id="billingQuestion">I have a question about billing</a>
      <a class="support-btn" id="setupQuestion">I need help with my setup</a>
      <a class="support-btn" id="bonusQuestion">My bonuses / upgrades</a>
      <a class="support-btn" id="otherQuestion">Something else</a>
    </div>

  </div>
</div>

<script>
function openVideoModal() {
  document.getElementById("videoModal").style.display = "flex";
  document.getElementById("welcomeVideo").src =
    "https://fast.wistia.net/embed/iframe/enubdt4h1t?autoplay=1";

  /* ✅ smooth: stop background scrolling while modal open */
  document.body.style.overflow = "hidden";
}

function closeVideoModal() {
  document.getElementById("videoModal").style.display = "none";
  document.getElementById("welcomeVideo").src = "";

  /* ✅ restore scroll */
  document.body.style.overflow = "";
}

function openSupportModal() {
  document.getElementById("supportModal").style.display = "flex";
}

function closeSupportModal() {
  document.getElementById("supportModal").style.display = "none";
}

const params = new URLSearchParams(window.location.search);

const receipts = params.get("cbreceipt");
let orderID = receipts ? receipts.split("|")[0] : "Unknown";

document.getElementById("order-id").textContent = orderID;

const fullName = params.get("cname");
const email = params.get("cemail");
const country = params.get("ccountry");
const zip = params.get("czip");

if (fullName) document.getElementById("customer-name").textContent = fullName;
if (email) document.getElementById("customer-email").textContent = email;

let shippingHTML = "";
if (zip) shippingHTML += zip + "<br>";
if (country) shippingHTML += country;
document.getElementById("shipping-address").innerHTML = shippingHTML;

/* ================= DEFAULT REPLIES WITH ORDER NUMBER + PROMPT ================= */
const detailsBlock =
  `\n\n-----------------------------\n` +
  `[ENTER DETAILS HERE]\n\n` +
  `Please provide the following so we can help you faster:\n` +
  `- What issue are you facing?\n` +
  `- Which product does this relate to?\n` +
  `- Any screenshots or details?\n` +
  `-----------------------------\n`;

function mailto(subject, body) {
  return `mailto:support@getpegasusofficial.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

document.getElementById("orderQuestion").href = mailto(
  `Question about my order #${orderID}`,
  `Hello,\n\nI have a question about my order.\n\nOrder Number: ${orderID}\n` + detailsBlock
);

document.getElementById("billingQuestion").href = mailto(
  `Billing question for order #${orderID}`,
  `Hello,\n\nI have a billing question regarding my order.\n\nOrder Number: ${orderID}\n` + detailsBlock
);

document.getElementById("setupQuestion").href = mailto(
  `Setup help needed — order #${orderID}`,
  `Hello,\n\nI need help setting up my purchase.\n\nOrder Number: ${orderID}\n` + detailsBlock
);

document.getElementById("bonusQuestion").href = mailto(
  `Bonuses / upgrades — order #${orderID}`,
  `Hello,\n\nI have a question about my bonuses/upgrades.\n\nOrder Number: ${orderID}\n` + detailsBlock
);

document.getElementById("otherQuestion").href = mailto(
  `Other question about order #${orderID}`,
  `Hello,\n\nI have another question regarding my purchase.\n\nOrder Number: ${orderID}\n` + detailsBlock
);

/* ================ ORDER SUMMARY ================ */
const productMap = {
  "1": { name: "Pegasus", price: 47, img: "/images/main-product.png", url: "https://mypegasusnow.com/ty-access/" },
  "2": { name: "The Code", price: 97, img: "/images/the-code-laptop.png", url: "https://mypegasusnow.com/ty-access/the-code-access/" },
  "3": { name: "The Code ($30 OFF)", price: 67, img: "/images/the-code-laptop.png", url: "/https://mypegasusnow.com/ty-access/the-code-access/" },
  "4": { name: "The Vault", price: 67, img: "/images/the-vault-laptop.png", url: "https://mypegasusnow.com/ty-access/the-vault-access/" },
  "5": { name: "The Vault ($40 OFF)", price: 27, img: "/images/the-vault-laptop.png", url: "https://mypegasusnow.com/ty-access/the-vault-access/" },
  "6": { name: "Pegasus X-Files", price: 29, img: "/images/pegasus-x-laptop.png", url: "https://mypegasusnow.com/ty-access/x-files-access/" },
  "7": { name: "Pegasus X-Files ($10 OFF)", price: 19, img: "/images/pegasus-x-laptop.png", url: "https://mypegasusnow.com/ty-access/x-files-access/" }
};


let purchased = [];
const itemString = params.get("item");
if (itemString) purchased = itemString.split("|");

let summaryHTML = "";
let total = 0;

purchased.forEach(id => {
  const p = productMap[id];
  if (!p) return;

  total += p.price;

  summaryHTML += `
    <div class="order-item">
      <img src="${p.img}" alt="">
      <div class="order-name">
        ${p.name}
        <br>
        <a class="access-btn" href="${p.url}" target="_blank" rel="noopener">Access Product</a>
      </div>
      <div class="order-price">$${p.price}.00</div>
    </div>
  `;
});

document.getElementById("order-summary").innerHTML = summaryHTML;
document.getElementById("order-total").textContent = "Total: $" + total.toFixed(2);
</script>

</body>
</html>
